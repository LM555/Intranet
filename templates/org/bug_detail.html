{% extends "org/base_3col.html" %}
{% block extrahead %}
<script src="{{ media_url }}/MochiKit/MochiKit.js" type="text/javascript"></script>
<script src="{{ media_url }}/MochiKit/Position.js" type="text/javascript"></script>
<script src="{{ media_url }}/MochiKit/Visual.js" type="text/javascript"></script>
{% endblock %}
{% load box %}
{% block title %}Hrošči in želje{% endblock %}

{% block heading %}
        <h1>Hrošči</h1>
{% endblock %}

{% block content-related-left %}
  <div class="module" id="recent-actions-module">
    	    <h2>Urejanje</h2>
  	 <!--<ul class="actionlist">
  	 	{% comment %} {% if object.resolved %} {% endcomment %}
  	 	{% if object.resolution__isnull  %}
			{% comment %}{% if user in object.assign.all %} {% endcomment %}
				<li><a href="/intranet/bugs/{{ object.id }}/done/">Oznaci kot opravljeno</a></li>
			{% comment %}{% else %}
				<li><a href="/intranet/bugs/{{ object.id }}/take/">Prevzami razresevanje</a></li>
			{% endifequal %} {% endcomment %}
		{% else %}
			<li>Ta hrosc je ze odpravljen</li>
		{% endif %}
			<li>
		<form action = "move/" method="post" name="MoveBugForm">
		<input type="submit" value="Preusmeri"/> k:
			<select selected name="assign">
				{% box_list User "" %}
			</select>
			, ker:
			<textarea name="note" id="note" rows="5" cols="20"></textarea>
			<br>

		</form> -->

		{% box_add Bug object.id edit %}


        <form action = "resolve/" method="post" name="BugResolutionForm">
        <input type = "submit" value = "Resi"/>
            <select name="status">
            {% for resolution in resolutions %}
                <option value="{{ resolution.id }}"{% ifequal object.resolution.id resolution.id %} selected="selected" {% endifequal %}>{{ resolution.name }}</option>
            {% endfor %}
            </select>
        </form>
				</li>
	</ul>
  </div>
{% endblock %}

{% block content-main %}
	<div class="module">
	<h2>{{ object.name }}</h2>
          <p>{{ object.author }} -> {% for guilty in object.assign.all %} {{ guilty }}, {% endfor %}
             ({{ object.pub_date|date:"d.m.Y" }})</p>
          <p>{{ object.note|escape|linebreaks }}</p>
        
    </div>


    {% if object.get_related %}
    <div class="module">
    <h2> related bugi </h2>
        {% for bug in object.get_related %}
            <a href="{{ bug.get_absolute_url }}"> {{ bug }} </a>
        {% endfor %}
    </div>
    <br><br>
    {% endif %}

  <div class="module">
    <h2 class="expand"><img src="{{ media_url }}/img/expand.gif" alt="expand bug" />add subtask</h2>
    <div id="bug_box" class="invisible">{% box_add Bug object.id %} </div>
  </div>

    {% for comment in comments %}
        {% ifequal comment.bug object %}
        <div class="module">
            <h2> {{ comment.author }} @ {{ comment.date }} </h2>
                {{ comment.text }}
        </div>
        {% endifequal %}
    {% endfor %}
    <br><br>

    <div class="module">
    <h2> dodaj komentar </h2>
    <form method="post" action="">
    <table>{{ comment_form }}</table>
    <input type="submit" value="comon, make my day"/>
    </form>
    </div>


	{% comment %}{% loadcomments object user %}{% endcomment %}

  <script type="text/javascript" charset="utf-8">
  // <![CDATA[
  function makeVisible(elem) {
      removeElementClass(elem, "invisible");
  }

  function isVisible(elem) {
      return !hasElementClass(elem, "invisible");
  };
      
  var i = null;
  box_list = new Object();
    //box_list.diary_box = $("diary_box")
    box_list.bug_box =  $("bug_box")
   // box_list.lend_box =  $("lend_box")
        
  slide = function(e) {
      for (var b in box_list){
        if (box_list[b].parentNode == e.src() ){
          box_div = box_list[b];
        }
      }
      foo = box_div;
      if (isVisible(foo) == false){
        makeVisible(foo);
      };
  }  
  for (var box in box_list){
    connect(box_list[box].parentNode, 'onclick', slide);
    log(box);
  }
  // ]]>
  </script>
{% endblock %}

{% block content-related-right %}
  <div class="module" id="recent-actions-module">
    <h2>Kazalo odprtih hroscev</h2>
  	 {% comment %} {% box_list Bug "resolved__exact=False" "template=org/list_my_bugs.html" %} {% endcomment %}
  	 {% box_list Bug "resolution__isnull=True" "template=org/list_my_bugs.html" %}
</div>
{% endblock %}
